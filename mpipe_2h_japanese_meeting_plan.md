# 2時間・日本語会議に耐える議事録パイプライン作り込みプラン（minutes-pipeline / mpipe）
更新日: 2026-01-30

## ゴール（このプランで達成したい状態）
- **2時間・日本語・複数話者**の会議（Teams録画 mp4）から、毎回ブレにくい **議事録（ドラフト）** を生成できる
- 会社PCで **API不可 / 高性能PC不可**でも回るように、要約は **ChatGPT / Copilot の対話UI**（手動）を主運用にする
- 改善が積み上がるように、**テストデータ＋回帰評価**（最低3本）を常に回せる

---

## 想定会議（追加の前提）
要件：**2時間 / 日本語** に加えて、現実的に起きる要素を想定して設計します。

- 参加者：4〜10名（話者切替が頻繁）
- 内容：進捗共有＋意思決定＋宿題（ToDo）＋次回アクション
- ノイズ：相づち、言い淀み、雑談、回線ノイズ、被り発話
- 構成：複数トピックが時間で連続（「話題転換」が何度も発生）

> この前提を外れるケース（講演形式/1人話が大半/英語混在など）は、後で追加対応できるようにします。

---

## 成功指標（KPI）
まずは "精度" より "運用で役に立つ" を先に固めます。

### フォーマット安定（最優先）
- 必須セクションが毎回出る（サマリ/決定事項/ToDo/論点/未決事項/次アクション）
- ToDo表が崩れない（担当・内容・期限）

### 抽出品質（人手チェックでOK）
- 決定事項の抜け/誤りが少ない
- ToDoの「担当」または「期限」が埋まる率が上がる
- 2時間でも、手修正が "ゼロではないが現実的な量" に収まる

### 再現性
- 同じ入力と同じ指示で、出力のブレが許容範囲に収まる

---

## 全体アーキテクチャ（2時間対応の要点）
2時間は "長い文字起こし" がボトルネックになります。対話UIを使う前提では、**分割→部分要約→統合**が基本戦略です。

1. **ASR**：mp4 → transcript_raw.json（Whisper）
2. **前処理**：正規化/ノイズ除去 → transcript_clean.json
3. **分割（チャンク化）**：2時間を UIで扱えるサイズに分割
4. **部分要約**：各チャンクから「論点/決定/ToDo候補」を抽出
5. **統合要約**：部分要約をまとめて最終JSON（Schema準拠）
6. **レンダリング**：JSON → minutes_draft.md（一定フォーマット）
7. **品質チェック**：Schema検証、重複ToDo、矛盾期限、空欄率など

---

## フェーズ計画（個人開発向け：最短で価値が出る順）

### Phase 1：2時間対応の"分割（チャンク化）"を実装する
**狙い：** 対話UIの制限（入力サイズ/コンテキスト）に確実に勝つ。

- 追加コマンド案：
  - `mpipe chunk output/<run>/transcript_clean.json`
- 出力（例）：
  - `output/<run>/chunks/chunk_01.txt`
  - `output/<run>/chunks/chunk_02.txt`
  - `output/<run>/chunks/manifest.json`（各チャンクの開始時刻/終了時刻/文字数）

**分割戦略（v1）**
- まずは確実に動く「文字数分割」：20k〜40k chars を目安
- 可能なら「時間＋沈黙ギャップ分割」：話題転換の境目になりやすい

**合格条件**
- 2時間の transcript でも、チャンクファイルが安定して生成される
- チャンクごとに時刻が追える（最低でも開始時刻）

---

### Phase 2：部分要約（チャンク→中間JSON）を固める
**狙い：** チャンク単位で "抽出" を強くし、統合時の漏れを減らす。

- ChatGPT/Copilot UI での作業フロー（提案）
  1) chunk_01.txt を添付 → 指示（抽出専用）
  2) chunk_02.txt を添付 → 指示（抽出専用）
  3) …
  4) まとめ用の指示で統合（最終JSONへ）

- 中間JSONの設計（最小）
  - `decisions[]`（決定事項候補）
  - `todos[]`（担当/内容/期限、分からなければ空欄可）
  - `topics[]`（論点ラベル）
  - `evidence[]`（任意：タイムスタンプと根拠の短い引用）

> "証跡（evidence）" を入れると、後で人が確認しやすく、クライアント連携の信頼性が上がります。

**合格条件**
- どのチャンクでも同じ形式の中間JSONが返る（ブレが少ない）
- ToDoが「0件」になりにくい（完全に無い会議以外）

---

### Phase 3：統合要約（中間JSON→最終JSON）を固める
**狙い：** 長文要約の破綻を避け、最終アウトプットの安定性を確保する。

- 統合の入力は「文字起こし全文」ではなく、**中間JSONの束**にする
  - 例：`output/<run>/partials/partial_01.json` …
- 追加コマンド案：
  - `mpipe merge output/<run>/partials/*.json`
  - もしくは手動でJSONを貼り付けて統合（最初はこれでOK）

**統合時のルール（LLM指示に入れる）**
- 重複ToDoは統合する（同一タスクに1件に）
- 期限の矛盾があれば「未確定」に落とす
- 決定事項と未決事項を混同しない

**合格条件**
- 最終JSONがSchema準拠で返る
- 最終mdのフォーマットが崩れない

---

### Phase 4：品質チェック（機械的に落とせる不良を潰す）
**狙い：** "出してから気づく" を減らす。

- Schema検証（既にある想定）
- 追加の静的チェック例（Pythonで簡単にできる）
  - ToDoの `owner/task/due` の空欄率を出す
  - 期限の形式を正規化（例：YYYY-MM-DD か "次回まで"）
  - 決定事項が0件・ToDoが0件のときは警告

**合格条件**
- "怪しい出力" がログで分かる（人がレビューしやすい）

---

### Phase 5：回帰評価（ゴールデンセットで劣化を防ぐ）
**狙い：** 辞書やプロンプト改善が積み上がる状態を作る。

- ゴールデンセット（最低3本）
  - 短：10〜15分相当（早く回せる）
  - 中：30〜45分相当
  - 長：**2時間相当**（最終ターゲット）
- 評価指標（最小）
  - 決定事項件数 / ToDo件数
  - ToDo空欄率（担当・期限）
  - レビュー所要時間（主観でOK）

**合格条件**
- 改善で "致命的崩れ" が再発しない（章落ち、JSON崩れ等）

---

## テストデータ（インターネット上の参考ソース）
個人開発では、機密の社内mp4を持ち出さずに "長時間・日本語・複数話者" を再現できるデータが重要です。  
**掲載方針：MP4形式でダウンロードできるサイトのみ掲載します。ページ上でしか閲覧できないストリーミング配信は対象外です。**  
※利用規約・著作権・二次利用条件は必ず各サイトで確認してください。

### MP4でダウンロード可能なソース（2026年1月時点）
調査時点では、**日本語・長時間・複数話者の会議動画を、公式にMP4でダウンロードできるサイトは確認できませんでした。**

- 国会・地方議会の審議中継（衆議院TV、参議院WebTV、東京都議会、各地方議会など）は、いずれも**ストリーミング視聴のみ**で、公式のMP4ダウンロード機能は提供されていません。
- 国会会議録検索システムは**テキスト・PDFのみ**で動画はありません。
- 研究用コーパス（CEJC、CSJ、SRC、BTSJ等）は、中納言では音声・映像のダウンロード不可、または有償メディア提供・音声のみ配布など、**サイト上でMP4を直接ダウンロードできる形態では提供されていません。**

該当するソースが見つかり次第、ここに追記してください。

---

## 実務への落とし込み（あなたの運用に合わせた最短ルート）
1) まずは **地方議会の2時間動画**を1本選んで、ASR→前処理→チャンク化まで通す  
2) ChatGPT/Copilot UIで **チャンク別抽出→統合**を試し、指示文を固める  
3) 社内mp4（ローカルのみ）で同手順を回し、`terms.csv` と `stop_phrases.txt` を育てる  
4) ゴールデンセット3本を作り、以降は必ず回帰（劣化防止）

---

## 次に実装すると効く"具体"タスク（Backlog）
- [ ] `mpipe chunk`（文字数＋タイムスタンプ付き manifest）
- [ ] `mpipe request --mode=chunked`（チャンク毎に instructions/ファイル生成）
- [ ] `mpipe merge`（partial JSONをまとめて最終JSONへ：まずは単純結合→重複除去）
- [ ] チェック機能：ToDo空欄率、期限形式、章落ち警告
- [ ] "証跡（evidence）" 対応：決定事項/ToDoにタイムスタンプを付ける（任意）

---

## 付録：対話UI向けの指示テンプレ（概要）
### チャンク抽出（中間JSON）
- 出力はJSONのみ（コードフェンス禁止）
- 決定事項とToDoを最優先で抽出
- 可能なら根拠タイムスタンプも付与

### 統合（最終JSON）
- partialを統合し、重複排除
- 決定事項/未決事項の分類を厳密に
- ToDoの担当/期限が不明なら空欄、推測しない
