# mpipe LLM指示プロンプト集（チャンク抽出 → 統合）
更新日: 2026-01-30

このファイルは **2時間・日本語会議**を想定し、ChatGPT / Copilot の**対話UI**で安定して議事録JSONを作るための「コピペ用プロンプト」をまとめたものです。

- 目的：長時間（2時間）でも **取りこぼしとブレを減らす**
- 戦略：**チャンクごとに抽出JSON（partial）→ 最後に統合JSON（final）**
- 重要：LLMの出力は **JSONのみ**（前置き・解説・コードフェンス禁止）

---

## 使い方（最短）
### A) チャンク抽出（繰り返し）
1. チャンクの文字起こし（例：`chunk_01.txt`）を **添付**（または貼り付け）
2. 下の **「PROMPT-1」** を貼り付けて実行
3. 返ってきたJSONを `partial_01.json` のように保存（UTF-8）

### B) 統合（最後に1回）
1. `partial_01.json`〜`partial_N.json` を **全部添付**（またはまとめて貼り付け）
2. 下の **「PROMPT-2」** を貼り付けて実行
3. 返ってきたJSONを `llm_output.json` として保存（UTF-8）
4. ツール側で `mpipe apply ...` して md 生成（あなたの運用）

---

## 中間JSON（partial）の固定フォーマット
チャンク抽出で返すJSONは **この形に固定**します（後工程の統合を安定させるため）。

### partial JSON（最小スキーマ）
- `chunk_id`: 例 `"01"`
- `range`: `"from"`, `"to"`（MM:SS）
- `topics`: そのチャンクの論点ラベル（短く）
- `decisions`: 決定事項候補
- `todos`: ToDo候補（`owner`, `task`, `due`）
- `open_questions`: 未決事項・確認事項
- `risks`: リスク/懸念（あれば）
- `evidence`: 根拠（任意だが推奨：`timestamp`, `item_type`, `text`）
- `notes`: 補足（任意）

> ※担当・期限が不明なら空文字でOK。ただし「推測」はしない。  
> ※evidenceの`text`は短く（最大でも1〜2文）。

---

## 最終JSON（final）の固定フォーマット（minutes_schema準拠）
統合で返すJSONは、あなたの `minutes_schema.json` に合わせて **必須キーを必ず出す**想定です。  
（以下は現在の既定想定に合わせた必須キー）

- `meeting`: `('title', 'date', 'participants')`
- `summary`: `string[]`
- `decisions`: `string[]`
- `todos`: `('owner', 'task', 'due')[]`
- `topics`: `string[]`
- `open_questions`: `string[]`
- `next_steps`: `string[]`
- `notes`（任意）

---

# PROMPT-1：チャンク抽出（partial JSON生成）
下の文章を **そのまま貼り付け**てください（チャンクごとに実行）。

---

あなたは高精度な議事録作成アシスタントです。  
添付（または直前に貼り付けられた）文字起こしは「会議の一部分（チャンク）」です。

**必ず守ること：**
- **出力はJSONのみ**
- **コードフェンス（```）・前置き・解説は禁止**
- 不確かなことは推測しない（不明なら空文字や「未確定」）
- 決定事項（確定/合意/方針）とToDo（担当・内容・期限）を最優先
- 同じ内容を言い換えて重複させない（同一チャンク内は統合）
- 日本語で出力する

**出力するJSONの形式（このキーを必ず含める）：**
{
  "chunk_id": "<ここはあなたが判断して01/02のように埋める。分からなければ空文字>",
  "range": {"from": "<MM:SS>", "to": "<MM:SS>"},
  "topics": ["<論点ラベル1>", "<論点ラベル2>"],
  "decisions": ["<決定事項1>", "<決定事項2>"],
  "todos": [
    {"owner": "<担当者>", "task": "<やること>", "due": "<期限/目安>"}
  ],
  "open_questions": ["<未決事項/確認事項>"],
  "risks": ["<懸念/リスク>"],
  "evidence": [
    {"timestamp": "<MM:SS>", "item_type": "decision|todo|topic|question|risk", "text": "<根拠の短い引用/要約>"}
  ],
  "notes": "<補足があれば>"
}

**抽出ガイド：**
- 「決定事項」は、明確に合意/確定したものだけ（検討中は open_questions へ）
- 「ToDo」は、誰が/何を/いつまでに（不明なら空文字、ただし推測しない）
- 「topics」は短いラベル（例：`要件整理`, `スケジュール`, `リスク`, `担当割り`）
- evidenceは可能な範囲で付ける（最低でも決定事項・重要ToDoは付ける）

それでは、チャンク文字起こしを読み取り、上記形式のJSONのみを返してください。

---

# PROMPT-2：統合（partial → final JSON生成）
下の文章を **そのまま貼り付け**てください（最後に1回）。

---

あなたは高精度な議事録作成アシスタントです。  
添付（または直前に貼り付けられた）ファイルは、チャンクごとの **partial JSON**（複数）です。  
これらを統合して、会議全体の **最終議事録JSON（final）** を作成してください。

**必ず守ること：**
- **出力はJSONのみ**
- **コードフェンス（```）・前置き・解説は禁止**
- 不確かなことは推測しない（不明なら空文字や「未確定」）
- 同一ToDo/決定事項は統合し、重複を除去する
- 決定事項と未決事項を混同しない（検討中は open_questions）
- 期限が矛盾する場合は「未確定」に落とす（勝手に決めない）
- 日本語で出力する

**最終JSONの必須形式：**
{
  "meeting": {
    "title": "<会議タイトル（不明なら空文字）>",
    "date": "<日付（不明なら空文字）>",
    "participants": ["<参加者名1>", "<参加者名2>"]
  },
  "summary": ["<全体サマリ箇条書き>"],
  "decisions": ["<決定事項（会議全体）>"],
  "todos": [
    {"owner": "<担当者>", "task": "<やること>", "due": "<期限/目安>"}
  ],
  "topics": ["<会議全体の主要トピック>"],
  "open_questions": ["<未決事項/次回確認>"],
  "next_steps": ["<次の進め方/次回までの動き>"],
  "notes": "<補足（任意、あれば）>"
}

**統合ルール：**
- decisions/todos/open_questions/risks を横断して重複排除
- ToDoの統合は「task内容が同一 or ほぼ同一」を目安に1件へ
- participants は partial 内に人名が出ている場合のみ追加（推測しない）
- summary は「会議の結論/合意点/重要論点/残課題」が一目で分かる粒度で 5〜12行程度
- next_steps は「次回までに何が進むべきか」を箇条書きで

それでは、提供された partial JSON 全体を統合し、上記形式のJSONのみを返してください。

---

## 追加：失敗しやすいパターンとリカバリ指示（LLMに返す一言）
LLMが前置きやMarkdownを出した場合、次の1文を返してやり直させてください。

- 「**JSONのみ**で返してください。コードフェンスや解説は禁止です。」

---

## おすすめの運用メモ（個人開発向け）
- チャンク抽出は「ToDo/決定事項の拾い漏れ」が起きやすいので、最初は evidence を付ける運用にする
- 統合フェーズで「重複除去」が効くので、チャンク抽出は **拾うこと優先**（ただし推測はしない）
- プロンプト改善は、まずPROMPT-1（抽出）の精度を上げるのが効く
